# Ledger Layer — 04_LEDGER

## Purpose

The ledger layer is responsible for **sealing atomic events into an ordered,
cryptographically attested event ledger**.

This layer is where the kernel commits to **exact sequence, exact structure,
and exact identity** of recorded events.

The ledger is the kernel’s **truth anchor**.

---

## What This Layer DOES

The ledger layer:

- Accepts a fully ordered list of atomic events
- Enforces declared ordering invariants
- Produces a deterministic, append-only event ledger
- Computes cryptographic hashes over the ordered event sequence
- Emits a canonical artifact suitable for replay and verification
- Makes ordering *material* and auditable

This layer produces **attestation**, not interpretation.

---

## What This Layer DOES NOT Do

The ledger layer will **never**:

- Infer causality, intent, or correctness
- Reorder events unless explicitly instructed by invariant rules
- Drop, merge, or synthesize events
- Summarize or collapse event sequences
- Interpret event payloads
- Perform analytics or scoring
- Generate reports or conclusions

If ordering or structure is ambiguous, that ambiguity must be preserved
and reflected in the ledger output.

---

## Determinism Guarantees

All ledger operations guarantee:

- No randomness
- No timestamps generated by the kernel
- No environment-dependent behavior
- Fixed, declared ordering only
- Identical inputs → identical ledger → identical hash

If determinism cannot be guaranteed, ledger construction must **refuse execution**.

---

## Canonical Hash Contract

The ledger produces the kernel’s **canonical hash**.

This hash attests to:

- The ordered event ledger
- The exact sequence and structure of events
- The declared kernel version
- The declared specification version

The canonical hash **does not** attest to:

- Reports
- Summaries
- Interpretations
- Downstream analyses
- Visualizations
- Human conclusions

Those artifacts live outside the kernel boundary.

---

## Files in This Directory

- `build_ledger.mjs`  
  Deterministically constructs the ordered event ledger and computes
  the canonical hash.

- `hash_utils.mjs`  
  Kernel-owned cryptographic utilities used exclusively for deterministic
  hashing and sealing.

- `ledger_schema.json`  
  Declarative schema defining the required structure of a valid event ledger.

Each executable must declare its own determinism guarantees and explicit refusals.

---

## Relationship to Other Layers

- Consumes output from `03_ATOMIZE`
- Enforced by invariants in `06_INVARIANTS`
- Produces artifacts verified by `08_CLI/pv_verify.mjs`
- Supplies truth anchors for downstream reporting and analysis layers

This layer is **non-optional**.

If the ledger is incorrect, all downstream artifacts are invalid.

---

## Stability Contract

Ledger behavior is **breaking by default**.

Any change to:

- event ordering
- hashing inputs
- hash envelope construction
- emitted ledger structure

requires:

- explicit version bump
- replay diff validation
- documented justification against `KERNEL_CHARTER.md`

Silent drift is prohibited.

---

## Final Invariant

The ledger records *what was recorded*.

It does not decide what happened.
